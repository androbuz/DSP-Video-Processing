<!DOCTYPE html>
<html>
<head>
</head>
  
<body>
<video id="video" width="0" height = "0"></video>

  <canvas id="canvas1"></canvas>
  <canvas id="canvas2"></canvas>

   <script language="javascript" type="text/javascript">
  
  // the simplest possible script to say which pixel is brighest using pixels from a live webcam.
 let width = 400;
 let height = 300;
     
 let canvas = document.getElementById("canvas1");
  
 let context = canvas.getContext('2d');
 let canvas2 = document.getElementById('canvas2');
 let context2 = canvas2.getContext('2d'); 
     
 canvas.addEventListener('mousemove', getMouse, false);

     // This sets the width and height to the document window
canvas.width = width;
canvas.height = height;
canvas2.width = width;
canvas2.height = height;
  
     // Grab elements, create settings, etc.
let video = document.getElementById('video');

video.style.display = 'none';
     
navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
	video.srcObject = stream;
	video.play();
});
     
var imageData = 0;
var resultData = 0;
     
function draw() {

 
  context2.drawImage(video,0,0,canvas.width,canvas.height);
  
  imageData = context2.getImageData(0,0,canvas.width, canvas.height);
  resultData = context.getImageData(0,0,canvas.width,canvas.height);
  
//lists to hold the rgb values
let reds = new Array(256).fill(0);
let greens = new Array(256).fill(0);
let blues = new Array(256).fill(0);
let rgb_data = new Array(256).fill(0);
     
// iterate over all pixels
for(var i = 0; i < canvas.height; i++) {
    // loop through each row
	for(var j = 0; j < canvas.width; j++) {
             
      		let position = ((canvas.width * i) + j) * 4;
      		let r = imageData.data[position];
            let g = imageData.data[position+1];
            let b = imageData.data[position+2];
      		reds[r]++;
      		greens[g]++;
      		blues[b]++;
      
      //rgb2luma
      let greyscale = 0.2126*r + 0.7152*g + 0.0722*b;
      rgb_data[greyscale | 0]++;
      
		resultData.data[position]=greyscale;     
		resultData.data[position+1]=greyscale;
     	resultData.data[position+2]=greyscale;  
		resultData.data[position+3]=255;//alpha  

    }
}
  
  drawHistogram(context2, reds, 0, 0, width, 100, 'red');
  drawHistogram(context2, greens, 0, 110, width, 100, 'green');
  drawHistogram(context2, blues, 0, 210, width, 100, 'blue');
  
  
	context.putImageData(resultData,0,0);
  	drawHistogram(context, rgb_data, 50, 0, width, 100, 'white');
	requestAnimationFrame(draw); 
}

//setInterval(draw,1000);
requestAnimationFrame(draw);

function getMouse(mousePosition) {
    mouseX = mousePosition.layerX;
    mouseY = mousePosition.layerY;
}
     
function drawHistogram(ctx, hist, x, y, w, h, color) {
  let max = Math.max(...hist);

  ctx.strokeStyle = color;
  ctx.beginPath();

  for (let i = 0; i < 256; i++) {
    let barHeight = (hist[i] / max) * h;
    let px = x + (i / 256) * w;
    let py = y + h - barHeight;

    ctx.moveTo(px, y + h);
    ctx.lineTo(px, py);
  }

  ctx.stroke();
}

</script>
</body>
</html>
